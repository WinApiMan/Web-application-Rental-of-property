@model RentalOfProperty.WebUserInterface.Models.Ad.AdsPageView
@using RentalOfProperty.WebUserInterface.Models.Ad

<script src="/js/_AdsPage.js"></script>
@{
    var resultText = Model.IsSuccess ? JsonSerializer.Serialize(Localizer["SuccessfulLoad"].Value) : JsonSerializer.Serialize(Localizer["UnsuccessfullLoad"]);

    if (Model.IsSuccess)
    {
        <script>
        let resultText =JSON.parse(JSON.stringify(@Html.Raw(resultText)));
        outputLoadResult(resultText);
        </script>
    }
}
<table class="table table-striped w-100">
    <thead>
        <tr>
            <th scope="col" class="text-md-center" style="width:20%"></th>
            <th scope="col" class="text-md-center" style="width:25%">@Localizer["AddressAndDescription"]</th>
            <th scope="col" class="text-md-center" style="width:17%">@Localizer["RealEstateData"]</th>
            <th scope="col" class="text-md-center" style="width:28%">@Localizer["Price"]</th>
            <th scope="col" class="text-md-center" style="width:10%">@Localizer["SourceLink"]</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ad in Model.AdViews)
        {
        string adColor = ad.RentalAdView.IsFavorite ? "#90EE90" : string.Empty;
        <tr style="background-color:@adColor">
            <td>
                <div id="carousel-@ad.RentalAdView.Id" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner">
                        @{
                            string imagePath = ad.HousingPhotos.Count() == 0 ? @"\Files\Images\DefaultAdPhoto.png" : ad.HousingPhotos.First().PathToPhoto;
                            <div class="carousel-item active" style="height:250px">
                                <img class="h-100 w-100" src="@imagePath" alt="@Localizer["ImageNotFound"]">
                            </div>
                        }
                        @foreach (var photo in ad.HousingPhotos)
                        {
                            <div class="carousel-item" style="height:250px">
                                <img class="h-100 w-100" src="@photo.PathToPhoto" alt="@Localizer["ImageNotFound"]">
                            </div>
                        }
                    </div>
                    @if (ad.HousingPhotos.Count() != 0)
                    {
                        <a class="carousel-control-prev" href="#carousel-@ad.RentalAdView.Id" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carousel-@ad.RentalAdView.Id" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    }
                </div>
            </td>
            <td>
                <div class="row">
                    <a asp-action="RentalAd" asp-controller="Ads" asp-route-id="@ad.RentalAdView.Id" class="col-md-12 text-primary pb-4">@ad.RentalAdView.Locality, @ad.RentalAdView.Address</a>
                    <div class="col-md-12">
                        @{ 
                            var descriptionArray = ad.RentalAdView.Description.ToArray();
                            var outputString = descriptionArray.Length < 130 ? string.Concat(descriptionArray.Take(descriptionArray.Length)) : string.Concat(descriptionArray.Take(130));
                        }
                        @outputString ...
                    </div>
                </div>
            </td>
            <td>
                <div class="row">
                    <div class="col-md-12 pt-4">
                        @Localizer["Rooms"]: @ad.RentalAdView.RentCountOfRooms / @ad.RentalAdView.TotalCountOfRooms
                    </div>
                    <div class="col-md-12">
                        @Localizer["Square"]: @(ad.RentalAdView.TotalArea <= 0 ? "-" : $"{ad.RentalAdView.TotalArea}") / @(ad.RentalAdView.LivingArea <= 0 ? "-" : $"{ad.RentalAdView.LivingArea}") / @(ad.RentalAdView.KitchenArea <= 0 ? "-" : $"{ad.RentalAdView.KitchenArea}") / @(ad.RentalAdView.LandArea <= 0 ? "-" : $"{ad.RentalAdView.LandArea}") м2
                    </div>
                    <div class="col-md-12">
                        @Localizer["Floors"]: @ad.RentalAdView.Floor / @ad.RentalAdView.TotalFloors
                    </div>
                </div>
            </td>
            @if (ad.RentalAdView is DailyRentalAdView)
            {
                var dailyAd = ad.RentalAdView as DailyRentalAdView;
                <td>
                    <div class="row">
                        @if (User.Identity.IsAuthenticated)
                        {
                        <form asp-controller="Ads" asp-action="AddOrRemoveFavorite" asp-route-rentalAdId="@ad.RentalAdView.Id" class="form-check col-md-12 text-left">
                            @if (ad.RentalAdView.IsFavorite)
                            {
                                <input class="btn btn-danger" type="submit" value="@Localizer["RemoveFromFavorites"]" />

                            }
                            else
                            {
                                <input class="btn btn-success" type="submit" value="@Localizer["AddToFavorites"]" />
                            }
                        </form>
                        }
                        <div class="col-md-12 row pb-4">
                            <div class="col-md-4 text-left">
                                @Localizer["PricePerPerson"]
                            </div>
                            <div class="col-md-4 text-center">
                                @(dailyAd.BYNPricePerPerson <= 0 ? Localizer["ContractPrice"].Value : $"{dailyAd.BYNPricePerPerson} {Localizer["BYNHuman"].Value}")
                            </div>
                            <div class="col-md-4 text-right">
                                @(dailyAd.USDPricePerPerson <= 0 ? Localizer["ContractPrice"].Value : $"{dailyAd.USDPricePerPerson} {Localizer["USDHuman"].Value}")
                            </div>
                        </div>
                        <div class="col-md-12 row pb-5">
                            <div class="col-md-4 text-left">
                                @Localizer["PricePerDay"]
                            </div>
                            <div class="col-md-4 text-center">
                                @(dailyAd.BYNPricePerDay <= 0 ? Localizer["ContractPrice"].Value : $"{dailyAd.BYNPricePerDay} {Localizer["BYNDay"].Value}")
                            </div>
                            <div class="col-md-4 text-right">
                                @(dailyAd.USDPricePerDay <= 0 ? Localizer["ContractPrice"].Value : $"{dailyAd.USDPricePerDay} {Localizer["USDDay"].Value}")
                            </div>
                        </div>
                        <div class="col-md-12 pt-3">
                            @Localizer["UpdateDateOnThisSite"] @ad.RentalAdView.UpdateDate.ToShortDateString().ToString(CultureInfo.CurrentUICulture)
                        </div>
                    </div>
                </td>
                <td class="text-md-center">
                    <div class="row text-md-center">
                        <a href="@ad.RentalAdView.SourceLink" class="text-warning col-md-12 pt-3">@Localizer["Source"]</a>
                    </div>
                </td>
            }
            else
            {
                var longTermAd = ad.RentalAdView as LongTermRentalAdView;
                <td>
                    <div class="row">
                        @if (User.Identity.IsAuthenticated)
                        {
                            <form asp-controller="Ads" asp-action="AddOrRemoveFavorite" asp-route-rentalAdId="@ad.RentalAdView.Id" class="form-check col-md-12 text-left">
                                @if (ad.RentalAdView.IsFavorite)
                                {
                                    <input class="btn btn-danger" type="submit" value="@Localizer["RemoveFromFavorites"]" />

                                }
                                else
                                {
                                    <input class="btn btn-success" type="submit" value="@Localizer["AddToFavorites"]" />
                                }
                            </form>
                        }
                        <div class="col-md-12 row pb-5 mb-4">
                            <div class="col-md-4 text-left">
                                @Localizer["Price"]
                            </div>
                            <div class="col-md-4 text-center">
                                @(longTermAd.BYNPrice <= 0 ? Localizer["ContractPrice"].Value : $"{longTermAd.BYNPrice} {Localizer["BYN"].Value}")
                            </div>
                            <div class="col-md-4 text-right">
                                @(longTermAd.USDPrice <= 0 ? Localizer["ContractPrice"].Value : $"{longTermAd.USDPrice} $")
                            </div>
                        </div>
                        <div class="col-md-12 pt-5 mt-3">
                            @Localizer["UpdateDateOnThisSite"] @ad.RentalAdView.UpdateDate.ToShortDateString().ToString(CultureInfo.CurrentUICulture)
                        </div>
                    </div>
                </td>
                <td class="text-md-center">
                    <div class="row text-md-center">
                        <a href="@ad.RentalAdView.SourceLink" class="text-warning col-md-12 pt-3">@Localizer["Source"]</a>
                    </div>
                </td>
            }
        </tr>
        }
    </tbody>
</table>
<nav aria-label="Page navigation example" class="mb-md-5 ml-md-4">
    <ul class="pagination">
        @{
            const int PagesLinks = 3, DefaultPageCount = 0;

            if (Model.PageInfo.PageNumber - PagesLinks > DefaultPageCount && Model.AdViews.Count() > DefaultPageCount)
            {
                <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="1" class="page-link">1</a></li>
                <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@(Model.PageInfo.PageNumber - PagesLinks - 1)" class="page-link">@Localizer["Previous"]</a></li>

                for (int index = PagesLinks; index > DefaultPageCount; index--)
                {
                    <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@(Model.PageInfo.PageNumber - index)" class="page-link">@(Model.PageInfo.PageNumber - index)</a></li>
                }
            }
            else
            {
                for (int index = 1; index < Model.PageInfo.PageNumber; index++)
                {
                    <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@index" class="page-link">@index</a></li>
                }
            }
            @if (Model.PageInfo.TotalItems > 30)
            {
            <li class="page-item active"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@Model.PageInfo.PageNumber" class="page-link">@Model.PageInfo.PageNumber</a></li>
            }

            if (Model.PageInfo.PageNumber + PagesLinks <= Model.PageInfo.TotalPages)
            {
                for (int index = DefaultPageCount + 1; index <= PagesLinks; index++)
                {
                    <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@(Model.PageInfo.PageNumber + index)" class="page-link">@(Model.PageInfo.PageNumber + index)</a></li>
                }

                <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@(Model.PageInfo.PageNumber + PagesLinks + 1)" class="page-link">@Localizer["Next"]</a></li>
                <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@Model.PageInfo.TotalPages" class="page-link">@Model.PageInfo.TotalPages</a></li>
            }
            else
            {
                for (int index = Model.PageInfo.PageNumber + 1; index <= Model.PageInfo.TotalPages; index++)
                {
                    <li class="page-item"><a asp-controller="Home" asp-action="Index" asp-route-pageNumber="@index" class="page-link">@index</a></li>
                }
            }
        }
    </ul>
</nav>